---
- name: Set facts for mytenants
  set_fact:
    mytenants: 
      - namespace: "portal1"
        portals:
          - name: "nestjs-auth"
            replicacount: 1
        mytenantname: "first_tenant"
      - namespace: "portal2"
        portals:
          - name: "another-auth"
            replicacount: 2
        mytenantname: "second_tenant"

- name: Debug mytenants variable
  debug:
    var: mytenants

- name: Render tenant configurations
  template:
    src: tenant_config.j2
    dest: "/tmp/{{ tenant.namespace }}_mytenants.yaml"
  loop:
    - tenant: "{{ item }}"
  vars:
    tenant: "{{ item.tenant }}"