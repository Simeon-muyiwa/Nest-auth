---
    - name: Install Node.js prerequisites
      apt:
        name:
          - apt-transport-https
          - gcc
          - g++
          - make
        state: present

    - name: Add Node.js GPG key
      apt_key:
        url: https://deb.nodesource.com/gpgkey/nodesource.gpg.key
        state: present

    - name: Add Node.js repository
      apt_repository:
        repo: "deb https://deb.nodesource.com/nodejs_{{ NODEJS_VERSION }} {{ ansible_distribution_release }} main"
        state: present
        update_cache: yes

    - name: Install Node.js
      apt:
        name: nodejs
        state: present

    - name: Install npm
      apt:
        name: npm
        state: present

    - name: Clean up old repositories
      apt_repository:
        repo: '*'
        state: absent
      when: ansible_facts['apt'] is defined
